const CACHE_TEST_CONFIG={testInterval:5e3,maxRetries:3,timeoutMs:1e4};let cacheTestResults={initialized:!1,lastTested:null,tests:{localStorage:{status:"pending",message:"",tested_at:null},sampleQuestions:{status:"pending",message:"",tested_at:null},cacheSize:{status:"pending",message:"",tested_at:null},cacheExpiry:{status:"pending",message:"",tested_at:null},functionality:{status:"pending",message:"",tested_at:null}},overall:{status:"pending",score:0,total:5}};function initializeCacheTestingSystem(){console.log("ðŸ§ª Initializing Cache Testing System...");try{return runAllCacheTests(),setInterval(runAllCacheTests,CACHE_TEST_CONFIG.testInterval),updateCacheTestUI(),cacheTestResults.initialized=!0,console.log("âœ… Cache Testing System initialized"),!0}catch(e){return console.error("âŒ Failed to initialize Cache Testing System:",e),!1}}async function runAllCacheTests(){console.log("ðŸ”¬ Running cache tests..."),cacheTestResults.lastTested=(new Date).toISOString(),await testLocalStorageAvailability(),await testSampleQuestionsCache(),await testCacheSize(),await testCacheExpiry(),await testCacheFunctionality(),calculateOverallScore(),updateCacheTestUI(),console.log("âœ… Cache tests completed")}async function testLocalStorageAvailability(){const e=cacheTestResults.tests.localStorage;e.tested_at=(new Date).toISOString();try{const t="stayfit_cache_test",s="test_"+Date.now();localStorage.setItem(t,s);const a=localStorage.getItem(t);localStorage.removeItem(t),a===s?(e.status="passed",e.message="LocalStorage read/write working correctly"):(e.status="failed",e.message="LocalStorage read/write mismatch")}catch(t){e.status="failed",e.message=`LocalStorage error: ${t.message}`}}async function testSampleQuestionsCache(){const e=cacheTestResults.tests.sampleQuestions;e.tested_at=(new Date).toISOString();try{const t="stayfit_sample_questions_cache",s=localStorage.getItem(t);if(!s)return e.status="failed",void(e.message="Sample questions cache not found");const a=JSON.parse(s),n=Object.keys(a.questions||{}).length;n>=5?(e.status="passed",e.message=`${n} sample questions cached successfully`):(e.status="warning",e.message=`Only ${n} questions cached (expected 5)`)}catch(t){e.status="failed",e.message=`Cache parsing error: ${t.message}`}}async function testCacheSize(){const e=cacheTestResults.tests.cacheSize;e.tested_at=(new Date).toISOString();try{const t="stayfit_sample_questions_cache",s=localStorage.getItem(t);if(!s)return e.status="failed",void(e.message="No cache data to measure");const a=new Blob([s]).size,n=Math.round(a/1024*100)/100;n>0&&n<1e3?(e.status="passed",e.message=`Cache size: ${n} KB (optimal)`):n>=1e3?(e.status="warning",e.message=`Cache size: ${n} KB (large)`):(e.status="failed",e.message="Cache size calculation failed")}catch(t){e.status="failed",e.message=`Size calculation error: ${t.message}`}}async function testCacheExpiry(){const e=cacheTestResults.tests.cacheExpiry;e.tested_at=(new Date).toISOString();try{const t="stayfit_sample_questions_cache",s=localStorage.getItem(t);if(!s)return e.status="failed",void(e.message="No cache data to check expiry");const a=JSON.parse(s),n=new Date(a.expires_at),c=new Date;if(n>c){const t=Math.round((n-c)/36e5*10)/10;e.status="passed",e.message=`Cache expires in ${t} hours`}else e.status="warning",e.message="Cache has expired and needs refresh"}catch(t){e.status="failed",e.message=`Expiry check error: ${t.message}`}}async function testCacheFunctionality(){const e=cacheTestResults.tests.functionality;e.tested_at=(new Date).toISOString();try{const t=["function"==typeof window.getCachedSampleResponse,"function"==typeof window.isSampleQuestion,"function"==typeof window.getCacheStats].filter(Boolean).length;if(3===t){const t="Show me my steps from last week",s=window.getCachedSampleResponse?window.getCachedSampleResponse(t):null;s&&s.response?(e.status="passed",e.message="All cache functions working correctly"):(e.status="warning",e.message="Functions available but cache retrieval failed")}else e.status="failed",e.message=`Only ${t}/3 cache functions available`}catch(t){e.status="failed",e.message=`Functionality test error: ${t.message}`}}function calculateOverallScore(){const e=cacheTestResults.tests;let t=0,s=0;Object.values(e).forEach(e=>{s++,"passed"===e.status?t++:"warning"===e.status&&(t+=.5)}),cacheTestResults.overall.score=t,cacheTestResults.overall.total=s,cacheTestResults.overall.status=t===s?"passed":t>=.7*s?"warning":"failed"}function updateCacheTestUI(){updateSystemStatusIndicator(),updateDetailedTestResults(),updateCacheStatistics()}function updateSystemStatusIndicator(){const e=document.querySelector(".alert-success");if(!e)return;const t=cacheTestResults.overall,s=Math.round(t.score/t.total*100);let a=e.querySelector(".cache-test-status");a||(a=document.createElement("span"),a.className="cache-test-status ms-3",e.querySelector(".flex-grow-1").appendChild(a));const n="passed"===t.status?"success":"warning"===t.status?"warning":"danger";a.innerHTML=`Cache Tests: <strong class="text-${n}">${s}% (${t.score}/${t.total})</strong>`}function updateDetailedTestResults(){const e=document.getElementById("cacheTestResults");if(!e)return;const t=cacheTestResults.tests;let s='<div class="row">';Object.entries(t).forEach(([e,t])=>{const a="passed"===t.status?"check-circle-fill text-success":"warning"===t.status?"exclamation-triangle-fill text-warning":"x-circle-fill text-danger";s+=`\n            <div class="col-md-6 mb-2">\n                <div class="d-flex align-items-center">\n                    <i class="bi bi-${a} me-2"></i>\n                    <div>\n                        <strong>${e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}</strong><br>\n                        <small class="text-muted">${t.message}</small>\n                    </div>\n                </div>\n            </div>\n        `}),s+="</div>",e.innerHTML=s}function updateCacheStatistics(){if("function"==typeof window.getCacheStats){const e=window.getCacheStats(),t=document.getElementById("cacheStats");t&&e.enabled&&(t.innerHTML=`\n                <div class="small text-muted">\n                    <i class="bi bi-info-circle me-1"></i>\n                    Cache: ${e.cached_questions} questions, \n                    ${Math.round(e.cache_size/1024)} KB, \n                    expires ${new Date(e.expires_at).toLocaleDateString()}\n                </div>\n            `)}}function showDetailedCacheTests(){const e=document.createElement("div");e.className="modal fade",e.innerHTML=`\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">\n                        <i class="bi bi-clipboard-check me-2"></i>Cache System Test Results\n                    </h5>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n                </div>\n                <div class="modal-body">\n                    <div class="alert alert-info">\n                        <strong>Overall Status:</strong> ${cacheTestResults.overall.status.toUpperCase()} \n                        (${cacheTestResults.overall.score}/${cacheTestResults.overall.total} tests passed)\n                        <br><small>Last tested: ${new Date(cacheTestResults.lastTested).toLocaleString()}</small>\n                    </div>\n                    <div id="cacheTestResults"></div>\n                    <div id="cacheStats" class="mt-3"></div>\n                </div>\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-primary" onclick="runAllCacheTests()">\n                        <i class="bi bi-arrow-clockwise me-1"></i>Run Tests Again\n                    </button>\n                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n                </div>\n            </div>\n        </div>\n    `,document.body.appendChild(e),new bootstrap.Modal(e).show(),updateDetailedTestResults(),updateCacheStatistics(),e.addEventListener("hidden.bs.modal",()=>{document.body.removeChild(e)})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeCacheTestingSystem):initializeCacheTestingSystem(),window.runAllCacheTests=runAllCacheTests,window.showDetailedCacheTests=showDetailedCacheTests,window.cacheTestResults=cacheTestResults,console.log("ðŸ§ª Cache Testing System loaded");